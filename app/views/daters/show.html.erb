<div class="dashboard-header">
  <h2><%= current_dater.f_name %>'s Profile</h2>
<div class="card" style="width=100%">

<h3>Your DATER Profile is <%= %> % complete</h3>
<button id="edit-user-profile-btn-percent" class="primary-btn btn-sm card-button"><span>% Complete</span></button>
<div class="card-deck-none" id="percent-complete">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">You can't view the Whole Pool until the following are complete</h5>
      <p class="text-left">Take at least one photo using PYT Dating's photo service</p>
      <p class="text-left">Have at least one backer</p>
      <p class="text-left"><small class="text-muted"></small></p>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">You'll get better match with a complete profile</h5>
      <p class="text-left">Backers:
        <p class="text-left text-navy"> <%= current_dater.backers.length %></p>
      <p class="text-left">PYT Photo: </p>
        <p class="text-left text-navy"> tbd...<%#= current_dater.pyt_image.nil? ? "Please take a photo!" : "Done" %></p>
      <p class="text-left">Physical Traits, Lifestyle, and Leanings: </p>
        <p class="text-left text-navy"> <%= current_dater.traits_complete?(current_dater.id) ? "At least one has been left blank" : "Done" %></p>
      <p class="text-left">Personality Traits: </p>
        <p class="text-left text-navy"> <%= current_dater.personalities_complete?(current_dater.id) ? "At least one has been left blank" : "Done" %></p>
      <p class="text-left">Mate Trait Preferences:</p>
        <p class="text-left text-navy">  <%= current_dater.mate_preferences_complete?(current_dater.id)  ? "At least one has been left blank" : "Done" %></p>
      <p class="text-left"><small class="text-muted"></small></p>
    </div>
  </div>
</div>


<button id="edit-user-profile-btn-backers" class="primary-btn btn-sm card-button"><span>Your Backers</span></button>
<div id="your-backers">
  <div class="card-deck-none" id="your-backers-deck">
    <div class="card">
      <div class="card-body-center">
        <h5 class="card-title">They got your back:</h5>
        <% if current_dater.backers.empty? %>
          <div class="alert alert-warning" role="alert">
            Wait, nobody's got your back? Connect your tribe.
          </div>
        <% else %>
          <% current_dater.backers.each do |b| %>
          <p class="text-left"><%= b.f_name.capitalize %> </p>
          <% end %>
        <% end %>
        <%= render 'add_backer' %>
        <p class="text-left"><small class="text-muted"></small></p>
      </div>
    </div>
  </div>
</div>


<button id="edit-user-profile-btn-pix" class="primary-btn btn-sm card-button"><span>Pictures</span></button>
  <div class="card-deck-none" id="pix">

      <div class="card-group">
        <% current_dater.dater_images(current_user.id).each do |image| %>
        <div class="card">
          <%= image_tag image.file, class:'', size:"100x100" %>
          <div class="card-footer">
            <small class="text-muted">Remove</small>
          </div>
        </div>
      <% end  %>
      </div>

  </div>


<button id="edit-user-profile-btn-traits" class="primary-btn btn-sm card-button"><span>Your Physical Traits, Lifestyle, and Leanings</span></button>
  <div class="card-deck-none" id="traits">

  <div class="card profile-card edit-traits">
      <div class="card-header text-center">
          Your Traits
      </div>
          <table class="table table-striped">
      <thead>
      <tr>
          <th scope="col">Trait</th>
          <th scope="col">Selection</th>
      </tr>
      </thead>
      <tbody>
    <%= form_for @dater.trait do |f| %>

       <tr>
          <td><%= f.label :height %></td>
          <td>
              <%=  number_field_tag "height_ft", nil, in: 4...10, id: 'number-input', value:"#{current_dater.trait.height/12}"%> ft
              <%= number_field_tag "height_in", nil, in: 0...12, id: 'number-input', value:"#{current_dater.trait.height%12}" %> in
          </td>
      </tr>
      <tr>
           <td><%= f.label :smoker %></td>
           <td><%= f.select :smoker, Trait.smokers.map { |key, value| [key.humanize, key] }, class: "btn btn-secondary dropdown-toggle", id:"dropdownMenu2", class:" form-control"%></td>
      </tr>
      <tr>
           <td><%= f.label :religiosity %></td>
           <td><%= f.select :religiosity, Trait.religiosities.map { |key, value| [key.humanize, key] }, class: "btn btn-secondary dropdown-toggle", id:"dropdownMenu2"%></td>
      </tr>
      <tr>
           <td><%= f.label :religion %></td>
           <td><%= f.select :religion, Trait.religions.map { |key, value| [key.humanize, key] }, class: "btn btn-secondary dropdown-toggle", id:"dropdownMenu2"%></td>
      </tr>
      <tr>
          <td><%= f.label :alcohol %></td>
          <td><%= f.select :alcohol, Trait.alcohols.map { |key, value| [key.humanize, key] } %></td>
      </tr>
      <tr>
          <td> <%= f.label :body_type %></td>
          <td><%= f.select :body_type, Trait.body_types.map { |key, value| [key.humanize, key] } %></td>
      </tr>
    <tr>
          <td> <%= f.label :has_kids %></td>
          <td><%=  f.select :has_kids, [['No Kids', false], ['Has Kids', true]]%></td>
      </tr>
      <tr>
          <td> <%= f.label :wants_kids %></td>
          <td><%= f.select :wants_kids, [['Eww', false], ['BABEEZ', true]] %></td>
      </tr>
      <tr>
          <td> <%= f.label :education %></td>
          <td><%= f.select :education, [['Not a college Grad', false], ['Collage Grad', true]] %></td>
      </tr>
      <tr>
           <td><%= f.label :politicalness %></td>
           <td><%= f.select :politicalness, Trait.politicalnesses.map { |key, value| [key.humanize, key] }, class: "btn btn-secondary dropdown-toggle", id:"dropdownMenu2"%></td>
      </tr>
      <tr>
          <td> <%= f.label :political_leaning %></td>
          <td><%= f.select :political_leaning, Trait.political_leanings.map { |key, value| [key.humanize, key] } %></td>
      </tr>
      <tr>
          <td> <%= f.label :zip %></td>
          <td> <%= f.number_field "zip", id: 'number-input'%> </td>
      </tr>
      <tr>
          <td><%= f.label :has_pets %></td>
          <td><%= f.select :has_pets, [['No Pets', false], ['Yes Pets', true]] %></td>
          </tr>
      <tr>
          <td> <%= f.label :orientation %></td>
          <td><%= f.select :orientation, Trait.orientations.map { |key, value| [key.humanize, key] } %></td>
      </tr>
      <tr>
          <td><%= f.label :gender %></td>
          <td><%= f.select :gender, Trait.genders.map { |key, value| [key.humanize, key] } %></td>
          </tr>
      </tbody>
  </table>
        <%= f.submit "Update" , class: "primary-btn btn-md" %>
  <% end %>
  </div>


  </div>


<button id="edit-user-profile-btn-personality" class="primary-btn btn-sm card-button"><span> Your Personality Traits</span></button>
    <div class="card-deck-none" id="personality">

      <div class="card">
        <div class="card-body">
          This is some text within a card body.
        </div>
      </div>

    </div>


<button id="edit-user-profile-btn-mates" class="primary-btn btn-sm card-button"><span>Your Preferences for a Match</span></button>
    <div class="card-deck-none" id="mates">

      <div class="card">
        <div class="card-body">
          This is some text within a card body.
        </div>
      </div>

    </div>


</div>

<script>

$("#edit-user-profile-btn-percent").click(function() {
  event.preventDefault()
  $("#percent-complete").toggleClass("card-deck")
})
$("#edit-user-profile-btn-backers").click(function() {
  event.preventDefault()
  $("#your-backers-deck").toggleClass("card-deck")
})

    $('#list-backer-button').click(function(){
      $('.list-backers').toggleClass('list-backers-show')
    })

    $('#list-backer-button').click(function(){
      $('.list-and-add-backers').toggleClass('list-backers-show')
    })

$("#edit-user-profile-btn-pix").click(function() {
  event.preventDefault()
  $("#pix").toggleClass("card-deck")
})
$("#edit-user-profile-btn-traits").click(function() {
  event.preventDefault()
  $("#traits").toggleClass("card-deck")
})
$("#edit-user-profile-btn-personality").click(function() {
  event.preventDefault()
  $("#personality").toggleClass("card-deck")
})
$("#edit-user-profile-btn-mates").click(function() {
  event.preventDefault()
  $("#mates").toggleClass("card-deck")
})



// DATER SEARCHES FOR BACKER BY NAME
    $('#find-backer-by-name').click(function(event) {
      event.preventDefault()
      let first = event.target.offsetParent.childNodes[1].value
      let last =  event.target.offsetParent.childNodes[3].value
      let currentUser = document.location.pathname.substr(11)

            fetch(`http://localhost:3000/api/v1/users?f_name=${first}&l_name=${last}`)
            .then((response) => response.json())
            .then((parsedBackers) => {
              console.log("line 122", parsedBackers)
              if (parsedBackers.length === 0) {
                // CAN'T FIND BY FIRST AND LAST NAME
                $("#your-backers").append(
                  `<div class="alert alert-warning" role="alert" id="backer-not-found-alert">
                    <h4 class="alert-heading">Oh Snap!</h4>
                      <p>That person isn't signed up. Send them an invite!</p>
                   </div>`)
                $("#backer-not-found-alert").delay( 3000 ).fadeOut( 300 )
              }

              else {
                //FOUND AT LEAST ONE PERSON BY THAT NAME. PRESENT NAME AND IMAGES FOR USER TO SELECT.
                $("#your-backers").append(
                   `<div class="alert alert-success" role="alert" id="backer-invited-alert">
                      <h4 class="alert-heading"> Which ${first.toUpperCase()} ${last.toUpperCase()} is your Framily Member?</h4>
                    </div>`)
                $("#backer-invited-alert").delay( 2000 ).fadeOut( 300 )
                parsedBackers.forEach(function(backer) {
                $("#your-backers").append(`
                  <div class="card" style="width: 10rem;">
                    <div class style="width: 50;">
                    <img class="card-img-top" src="${backer.image.url}" alt="Card image cap">
                    </div>
                    <div class="card-body">
                      <h5 class="card-title">${backer.f_name} ${backer.l_name}</h5>
                      <p class="card-text">...</p>
                      <a class ="primary-btn card-button text-center" id="connect-user-as-backer" data-text="${backer.id}">Connect!</a>
                    </div>
                  </div>
                `)
                })
              }
            })
            .catch(error => console.error(error))
    })

// DATER ADDS NEW BACKER...use backer_id in
    $('#your-backers').on("click", '#connect-user-as-backer', function(event) {
      event.preventDefault()
      let backerId = event.currentTarget.dataset.text

      $.get(`http://localhost:3000/invites?backer_id=${backerId}`)
      $("#your-backers").append(`
        <div class="alert alert-success" role="alert" id="dater-invited-alert">
          <h4 class="alert-heading"> Email Sent!</h4>
          `).delay( 1500 ).fadeOut( 300 )

      })



// SEND EMAIL TO INVITE NEW BACKER
    $(".card-body-center").on("click", "#invite-backer-button", function(event) {
      event.preventDefault()
      let email = event.target.offsetParent.childNodes[1].value
      $.get(`http://localhost:3000/invites?email=${email}&add_backer=true`)
      $("#your-backers").append(`
        <div class="alert alert-success" role="alert" id="dater-invited-alert">
          <h4 class="alert-heading"> Email Sent!</h4>
          `).delay( 1500 ).fadeOut( 300 )
      // $(".list-and-add-backers").html('')
    })



</script>
